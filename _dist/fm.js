"use strict";function o(){return discord.member.nick||discord.user.global_name||discord.user.username}function i(e){return discord.storage.server[e]??="{}",new Proxy({},{get(a,t){return JSON.parse(discord.storage.server[e]||"{}")[t]},set(a,t,s){let r=JSON.parse(discord.storage.server[e]||"{}");return r[t]=s,discord.storage.server[e]=JSON.stringify(r),!0}})}(async()=>{let e=i("fm");if(discord.variables.__args[0]==="eval"&&discord.user.id==="886685857560539176")return(0,eval)(discord.variables.__argsString.replace("eval ",""));if(discord.variables.__args[0]==="set"&&discord.variables.__args.length===2){if(!/^(-|_|[a-zA-Z0-9]){2,15}$/.test(discord.variables.__args[1]))return console.log("\u274C Invalid username.");e[discord.user.id]=discord.variables.__args[1],console.log(`<a:tay:1381363439791898735> Set your last.fm username to ${discord.variables.__args[1]}`);return}if(!e[discord.user.id])return console.log("\u274C You aren't registered, set your last.fm username by sending `.t fm set yourLastFmUsernameHere`.");(async()=>{let s=await(await fetch(`https://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&api_key=eebde839555fb94539f05e57021505df&user=${e[discord.user.id]}&limit=1&format=json&extended=1`)).json();if(s.error)return console.log("\u274C last.fm error, make sure that your username is valid.",JSON.stringify(s));let r=s.recenttracks.track[0];console.log(JSON.stringify({embed:{author:{icon_url:`https://cdn.discordapp.com/avatars/${discord.user.id}/${discord.user.avatar}.png`,name:`${(r["@attr"]?r["@attr"].nowplaying==="true":!1)?"Now playing - ":"Last track for "}${o()}`},description:`### [${r.name}](https://last.fm/user/${e[discord.user.id]})
**${r.artist.name}** \u2022 *${r.album["#text"]}*`,color:12189696,thumbnail:{url:r.image[r.image.length-1]["#text"]},footer:{text:`${r.loved==="1"?`${["\u2764\uFE0F","\u{1F9E1}","\u{1F49B}","\u{1F49A}","\u{1F499}","\u{1F49C}","\u{1F90D}","\u{1F496}","\u{1F49D}","\u{1FA75}","\u{1FA77}"][Math.floor(Math.random()*10)]} Loved track \u2022 `:""}${s.recenttracks["@attr"].total} user scrobbles`}}}))})()})();
